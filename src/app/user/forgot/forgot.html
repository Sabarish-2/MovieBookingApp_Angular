<form [formGroup]="forgotForm" (ngSubmit)="submit()" novalidate class="forgot-form">
    @if (errorMessage) {
    <div class="alert alert-danger" role="alert">{{ errorMessage }}</div>
    }

    @if (successMessage) {
    <div class="alert alert-success" role="alert">{{ successMessage }}</div>
    }

    <div class="mb-3">
        <label class="form-label">User ID</label>
        <input class="form-control" formControlName="userId" [readonly]="stage === 'reset'" />
        @if ((f.userId.touched || submitted) && f.userId.invalid) {
        <div class="text-danger small">User ID is required.</div>
        }
    </div>

    @if (stage === 'reset') {
    <div class="mb-3">
        <label class="form-label">New Password</label>
        <input type="password" class="form-control" formControlName="newPassword" />
        @if ((f.newPassword.touched || submitted) && f.newPassword.errors) {
        @if (f.newPassword.errors['required']) {
        <div class="text-danger small">New password is required.</div>
        }
        @if (f.newPassword.errors['weakPassword']) {
        <div class="text-danger small">Password must be at least 8 characters and include a number, lowercase,
            uppercase, and special character.</div>
        }
        }
    </div>

    <div class="mb-3">
        <label class="form-label">Confirm New Password</label>
        <input type="password" class="form-control" formControlName="confirmNewPassword" />
        @if ((f.confirmNewPassword.touched || submitted) && forgotForm.errors?.['newPasswordMismatch']) {
        <div class="text-danger small">Passwords do not match.</div>
        }
    </div>
    }

    <div class="d-flex gap-2 align-items-center">
        <button class="btn btn-primary" type="submit" [disabled]="isLoading">
            @if (isLoading) {
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            }
            {{ stage === 'lookup' ? 'Send Reset Request' : 'Update Password' }}
        </button>

        @if (stage === 'reset') {
        <button type="button" class="btn btn-outline-secondary" (click)="restart()" [disabled]="isLoading">
            Start Over
        </button>
        }
    </div>
</form>