import{a as U}from"./chunk-6HUOQXPP.js";import{a as Y}from"./chunk-MZG3V2G2.js";import{a as R}from"./chunk-BMQE7F7G.js";import{a as V,c as j,e as $,g as F,k as W}from"./chunk-HI2BIXZA.js";import{b as E,d as L}from"./chunk-EYZZHLEG.js";import{$a as x,$b as B,Ga as d,La as M,Lb as T,Va as P,Wa as p,Ya as f,Z as h,_,a as C,ab as s,b as S,bb as o,cb as k,gb as O,ib as D,jb as m,sb as w,tb as n,vb as b,wa as r,wb as N,xb as y,yb as A,zb as I}from"./chunk-NDO7E3F7.js";function q(i,t){i&1&&(s(0,"div",7),n(1," Loading movie details... "),o())}function G(i,t){if(i&1&&(s(0,"p",5)(1,"strong"),n(2,"Seats:"),o(),n(3),o()),i&2){let e=m(2);r(3),b(" ",e.seatPreview," ")}}function H(i,t){if(i&1&&(s(0,"div",10),k(1,"i",11),n(2),o()),i&2){let e=m(2);r(2),b(" ",e.bookingMessage," ")}}function J(i,t){i&1&&(k(0,"span",16),n(1," Booking... "))}function K(i,t){i&1&&(k(0,"i",17),n(1," Book Now "))}function Q(i,t){if(i&1){let e=O();s(0,"div",12)(1,"label",13),n(2,"Number of Seats"),o(),s(3,"input",14),I("ngModelChange",function(a){h(e);let l=m(2);return A(l.numberOfSeats,a)||(l.numberOfSeats=a),_(a)}),o()(),s(4,"button",15),D("click",function(){h(e);let a=m(2);return _(a.bookTickets())}),p(5,J,2,0)(6,K,2,0),o()}if(i&2){let e=m(2);r(3),y("ngModel",e.numberOfSeats),x("disabled",e.movieData.ticketsAvailable===0),P("min",1)("max",e.movieData.ticketsAvailable),r(),x("disabled",e.isLoading||e.movieData.movieStatus==="SOLD_OUT"||e.movieData.ticketsAvailable===0),r(),f(e.isLoading?5:6)}}function X(i,t){if(i&1&&(s(0,"div",8)(1,"p",9)(2,"strong"),n(3,"Movie:"),o(),n(4),o(),s(5,"p",9)(6,"strong"),n(7,"Theatre:"),o(),n(8),o(),s(9,"p",9)(10,"strong"),n(11,"Status:"),o(),s(12,"span"),n(13),o()(),s(14,"p",9)(15,"strong"),n(16,"Available:"),o(),n(17),o(),p(18,G,4,1,"p",5),o(),p(19,H,3,1,"div",10)(20,Q,7,6)),i&2){let e=m();r(4),b(" ",e.movieData.movieName," "),r(4),b(" ",e.movieData.theatreName," "),r(4),w("badge "+(e.movieData.movieStatus==="AVAILABLE"?"bg-success":e.movieData.movieStatus==="SOLD_OUT"?"bg-danger":"bg-warning")),r(),b(" ",e.movieData.movieStatus.replace("_"," ")," "),r(4),N(" ",e.movieData.ticketsAvailable," / ",e.movieData.ticketsAllotted," "),r(),f(e.seatPreview?18:-1),r(),f(e.bookingSuccess?19:20)}}var z=class i{constructor(t,e,c,a,l,v){this.route=t;this.router=e;this.movieService=c;this.ticketService=a;this.authService=l;this.cdr=v;this.movieName=this.route.snapshot.paramMap.get("movieName"),this.theatreName=this.route.snapshot.paramMap.get("theatreName")}movieData=null;movieName;theatreName;numberOfSeats=1;isLoading=!1;bookingSuccess=!1;bookingMessage="";ngOnInit(){this.movieService.getMovieByID(this.movieName,this.theatreName).subscribe({next:t=>{this.movieData=t,this.cdr.detectChanges()},error:t=>{console.error("Error fetching movie:",t)}})}bookTickets(){if(!this.movieData){alert("Movie data not loaded");return}if(this.numberOfSeats<=0){alert("Please enter a valid number of seats");return}if(this.numberOfSeats>this.movieData.ticketsAvailable){alert(`Only ${this.movieData.ticketsAvailable} seats available`);return}let t=this.authService.userID;if(!t){alert("You must be logged in to book tickets.");return}let e=this.numberOfSeats,c=this.getStartingSeatIndex();if(confirm(`Book ${e} ticket(s) for ${this.movieName}?`)){this.isLoading=!0;let l=this.generateSeatNumbers(e,c),v={userID:t,movieName:this.movieName,theatreName:this.theatreName,seatNumbers:l,quantity:e};this.ticketService.bookTickets(v).subscribe({next:u=>{if(this.isLoading=!1,this.bookingSuccess=!0,this.bookingMessage=`Successfully booked ${e} ticket(s)! Seats: ${l}!`,this.movieData){let g=Math.max(this.movieData.ticketsAvailable-e,0);this.movieData=S(C({},this.movieData),{ticketsAvailable:g}),g===0?this.numberOfSeats=1:this.numberOfSeats>g&&(this.numberOfSeats=g)}this.cdr.detectChanges(),setTimeout(()=>{this.router.navigate(["/movies"])},3e3)},error:u=>{this.isLoading=!1,alert("Failed to book tickets: "+(u.error?.message||u.message)),this.cdr.detectChanges()}})}}get seatPreview(){if(!this.movieData||this.movieData.ticketsAvailable<=0)return"";let t=Math.min(this.numberOfSeats,this.movieData.ticketsAvailable);return this.generateSeatNumbers(t,this.getStartingSeatIndex())}getStartingSeatIndex(){if(!this.movieData)return 0;let t=this.movieData.ticketsAllotted-this.movieData.ticketsAvailable;return t>0?t:0}generateSeatNumbers(t,e=0){let a=[];for(let l=0;l<t;l++){let v=e+l,u=Math.floor(v/10),g=v%10+1;a.push(`${this.resolveRowLabel(u)}${g}`)}return a.join(",")}resolveRowLabel(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c="",a=t;for(;a>=0;)c=e[a%e.length]+c,a=Math.floor(a/e.length)-1;return c}static \u0275fac=function(e){return new(e||i)(d(E),d(L),d(U),d(Y),d(R),d(T))};static \u0275cmp=M({type:i,selectors:[["app-booking-page"]],decls:10,vars:1,consts:[[1,"booking-page","container","mt-5"],[1,"row","justify-content-center"],[1,"col-lg-8","col-xl-6"],[1,"card","booking-card","shadow-sm"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body"],["role","alert",1,"alert","alert-info"],[1,"ticket-info","mb-3"],[1,"mb-1"],["role","alert",1,"alert","alert-success"],[1,"fa","fa-check-circle","me-2"],[1,"mb-3"],["for","numberOfSeats",1,"form-label","fw-semibold"],["type","number","id","numberOfSeats","placeholder","Enter number of seats",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"btn","btn-primary","w-100",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"fa","fa-ticket","me-2"]],template:function(e,c){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),n(6,"Book Tickets"),o()(),s(7,"div",6),p(8,q,2,0,"div",7)(9,X,21,9),o()()()()()),e&2&&(r(8),f(c.movieData?9:8))},dependencies:[B,W,V,F,j,$],styles:[".booking-card[_ngcontent-%COMP%]{position:sticky;top:2rem;border:none;border-radius:12px}.booking-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:1.5rem}.booking-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1.5rem}.booking-card[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.95rem;margin-bottom:.5rem}.booking-card[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:8px;border:2px solid #e9ecef;padding:.75rem;transition:all .3s ease}.booking-card[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{border-color:#667eea;box-shadow:0 0 0 .2rem #667eea26}.booking-card[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:1rem;border-radius:8px;border-left:4px solid #667eea}.booking-card[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#495057}.booking-card[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#212529}.booking-card[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{border-radius:8px;padding:.75rem;font-weight:600;transition:all .3s ease}.booking-card[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5568d3;transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.booking-card[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.booking-card[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{border-radius:8px;border:none;padding:1rem}.booking-card[_ngcontent-%COMP%]   .alert.alert-success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.booking-page[_ngcontent-%COMP%]   .booking-card[_ngcontent-%COMP%]{position:static;margin-top:2rem}"]})};export{z as BookingPage};
