import{a as k}from"./chunk-GIYV7ABN.js";import{a as M,b as p,c as S,d as E,f as N,h as y,i as I,j as T,l as O}from"./chunk-HI2BIXZA.js";import{d as F}from"./chunk-EYZZHLEG.js";import{$a as g,$b as x,B as C,Ga as c,La as v,Lb as P,Wa as d,Ya as l,ab as a,bb as r,cb as m,ib as b,jb as u,tb as s,ub as w,vb as h,wa as n}from"./chunk-NDO7E3F7.js";function A(e,o){if(e&1&&(a(0,"div",1),s(1),r()),e&2){let t=u();n(),w(t.successMessage)}}function L(e,o){e&1&&(a(0,"div",5),s(1,"User ID is required."),r())}function R(e,o){e&1&&(a(0,"div",5),s(1,"New password is required."),r())}function U(e,o){e&1&&(a(0,"div",5),s(1,"Add at least 8 characters."),r())}function V(e,o){e&1&&(a(0,"div",5),s(1,"Add a number."),r())}function q(e,o){e&1&&(a(0,"div",5),s(1,"Add a lowercase letter."),r())}function G(e,o){e&1&&(a(0,"div",5),s(1,"Add an uppercase letter."),r())}function j(e,o){e&1&&(a(0,"div",5),s(1,"Add a special character."),r())}function z(e,o){e&1&&(a(0,"div",5),s(1,"New password cannot be the same as the old password."),r())}function B(e,o){if(e&1&&(d(0,R,2,0,"div",5),d(1,U,2,0,"div",5),d(2,V,2,0,"div",5),d(3,q,2,0,"div",5),d(4,G,2,0,"div",5),d(5,j,2,0,"div",5),d(6,z,2,0,"div",5)),e&2){let t=u(2);l(t.f.newPassword.errors.required?0:-1),n(),l(t.f.newPassword.errors["Password must be at least 8 characters long."]?1:-1),n(),l(t.f.newPassword.errors["Password must include at least one number."]?2:-1),n(),l(t.f.newPassword.errors["Password must include at least one lowercase letter."]?3:-1),n(),l(t.f.newPassword.errors["Password must include at least one uppercase letter."]?4:-1),n(),l(t.f.newPassword.errors["Password must include at least one special character."]?5:-1),n(),l(t.f.newPassword.errors.notSameAsOldPassword?6:-1)}}function Z(e,o){e&1&&(a(0,"div",5),s(1,"Passwords do not match."),r())}function Y(e,o){if(e&1&&(a(0,"div",2)(1,"label",3),s(2,"New Password"),r(),m(3,"input",10),d(4,B,7,7),r(),a(5,"div",2)(6,"label",3),s(7,"Confirm New Password"),r(),m(8,"input",11),d(9,Z,2,0,"div",5),r()),e&2){let t=u();n(4),l((t.f.newPassword.touched||t.submitted)&&t.f.newPassword.errors?4:-1),n(5),l((t.f.confirmNewPassword.touched||t.submitted)&&(t.forgotForm.errors!=null&&t.forgotForm.errors.newPasswordMismatch)?9:-1)}}function H(e,o){e&1&&m(0,"span",8)}function J(e,o){if(e&1&&(a(0,"div",9),s(1),r()),e&2){let t=u();n(),w(t.errorMessage)}}function K(e){let o=e.value;if(!o)return{required:!0};let i=[{regex:/.{8,}/,message:"Password must be at least 8 characters long."},{regex:/[0-9]/,message:"Password must include at least one number."},{regex:/[a-z]/,message:"Password must include at least one lowercase letter."},{regex:/[A-Z]/,message:"Password must include at least one uppercase letter."},{regex:/[^A-Za-z0-9]/,message:"Password must include at least one special character."}].reduce((f,_)=>(_.regex.test(o)||(f[_.message]=!0),f),{});return Object.keys(i).length>0?i:null}function Q(e){let o=e.get("newPassword"),t=e.get("confirmNewPassword");return!o||!t||!o.enabled||!t.enabled||o.value===t.value?null:{newPasswordMismatch:!0}}var D=class e{constructor(o,t,i,f){this.fb=o;this.userService=t;this.router=i;this.cdr=f;this.forgotForm=this.fb.group({}),this.forgotForm=this.fb.group({userId:["",p.required],newPassword:[{value:"",disabled:!0},[p.required,K]],confirmNewPassword:[{value:"",disabled:!0},[p.required]]},{validators:Q})}forgotForm;submitted=!1;stage="lookup";isLoading=!1;errorMessage="";successMessage="";enableResetControls(){this.forgotForm.get("newPassword")?.enable(),this.forgotForm.get("confirmNewPassword")?.enable()}disableResetControls(){this.forgotForm.get("newPassword")?.disable(),this.forgotForm.get("confirmNewPassword")?.disable()}get f(){return this.forgotForm.controls}submit(){if(this.submitted=!0,this.errorMessage="",this.successMessage="",this.stage==="lookup"){let o=this.forgotForm.get("userId");if(!o||o.invalid||o.value==null||o.value.trim()==="")return;this.isLoading=!0,this.userService.userForgot(o.value).pipe(C(1)).subscribe({next:()=>{this.isLoading=!1,this.stage="reset",this.enableResetControls(),this.successMessage="Verification successful. You can now set a new password."},error:t=>{console.error("User lookup failed:",t),this.isLoading=!1,this.errorMessage=t?.error?.message||"Unable to verify user. Please check the ID and try again."}})}else{if(this.forgotForm.invalid)return;let o=this.forgotForm.get("userId")?.value,t=this.forgotForm.get("newPassword")?.value;if(!o||!t)return;this.isLoading=!0,this.userService.userLogin({loginID:o,password:t}).subscribe({next:()=>{this.isLoading=!1,this.errorMessage="New password cannot be the same as the old password."},error:()=>{this.userService.userForgotCheck(o,t).subscribe({next:()=>{this.isLoading=!1,this.stage="lookup",this.disableResetControls(),this.forgotForm.reset(),this.submitted=!1,this.successMessage="Password updated successfully. Redirecting to login...",setTimeout(()=>this.router.navigate(["/login"]),2e3)},error:i=>{console.error("Password reset check failed:",i),this.isLoading=!1,this.errorMessage=i?.error?.message||"Unable to reset password. Please try again."}})}})}}static \u0275fac=function(t){return new(t||e)(c(T),c(k),c(F),c(P))};static \u0275cmp=v({type:e,selectors:[["app-forgot"]],decls:13,vars:9,consts:[["novalidate","",1,"forgot-form","shadow-sm","p-4","bg-light","rounded",3,"ngSubmit","formGroup"],["role","alert",1,"alert","alert-success"],[1,"mb-3"],[1,"form-label"],["formControlName","userId","placeholder","Enter your User ID",1,"form-control",3,"readonly"],[1,"text-danger","small","mt-1"],[1,"d-flex","gap-2","align-items-center","mb-2"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],["role","alert",1,"alert","alert-danger"],["type","password","formControlName","newPassword","placeholder","Enter new password",1,"form-control"],["type","password","formControlName","confirmNewPassword","placeholder","Confirm new password",1,"form-control"]],template:function(t,i){t&1&&(a(0,"form",0),b("ngSubmit",function(){return i.submit()}),d(1,A,2,1,"div",1),a(2,"div",2)(3,"label",3),s(4,"Login / ID"),r(),m(5,"input",4),d(6,L,2,0,"div",5),r(),d(7,Y,10,2),a(8,"div",6)(9,"button",7),d(10,H,1,0,"span",8),s(11),r()(),d(12,J,2,1,"div",9),r()),t&2&&(g("formGroup",i.forgotForm),n(),l(i.successMessage?1:-1),n(4),g("readonly",i.stage==="reset"),n(),l((i.f.userId.touched||i.submitted)&&i.f.userId.invalid?6:-1),n(),l(i.stage==="reset"?7:-1),n(2),g("disabled",i.isLoading),n(),l(i.isLoading?10:-1),n(),h(" ",i.stage==="lookup"?"Verify User":"Update Password"," "),n(),l(i.errorMessage?12:-1))},dependencies:[x,O,N,M,S,E,I,y],styles:[".forgot-form[_ngcontent-%COMP%]{max-width:450px;margin:2rem auto;padding:2rem;border:1px solid #e0e0e0;border-radius:10px;background-color:#f8f9fa}.forgot-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:600;color:#495057}.forgot-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:5px;padding:.75rem;border:1px solid #ced4da}.forgot-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.forgot-form[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:1rem;border-radius:5px}.forgot-form[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{margin-bottom:1rem;padding:.75rem 1rem;border-radius:5px}.forgot-form[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{font-size:.875rem;margin-top:.25rem}"]})};export{D as Forgot};
